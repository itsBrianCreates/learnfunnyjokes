<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Dad Jokes - Local & API</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üòÇ</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <style>
      .fade-in {
        animation: fadeIn 0.4s ease-in;
      }

      .fade-out {
        animation: fadeOut 0.4s ease-out;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }
    </style>
</head>
<body>
    <div class="container">
        <h1>üòÇ Learn Funny Jokes üòÇ</h1>
        
        <div class="view-toggle">
            <button class="toggle-btn active" onclick="showMainView()" id="main-toggle">New Jokes</button>
            <button class="toggle-btn" onclick="showFavoritesView()" id="favorites-toggle">My Favorites <span class="favorites-count" id="favorites-count">(0)</span></button>
            <button class="toggle-btn" onclick="showHistoryView()" id="history-toggle">Recently Viewed <span class="favorites-count" id="history-count">(0)</span></button>
        </div>
        
        <div class="main-section active" id="main-section">
            <div class="navigation-controls">
                <button class="nav-btn" onclick="navigateHistory(-1)" id="prev-btn" disabled>‚Üê Previous</button>
                <div class="history-info" id="history-info">1 of 1</div>
                <button class="nav-btn" onclick="navigateHistory(1)" id="next-btn" disabled>Next ‚Üí</button>
            </div>
            
            <div class="joke-container">
                <div class="joke-text" id="joke-text">
                    Why don't scientists trust atoms?<br>
                    <span class="punchline">Because they make up everything!</span>
                </div>
                <div class="joke-actions">
                    <button class="favorite-btn" onclick="toggleFavorite()" id="favorite-btn" title="Add to favorites">‚ô°</button>
                    <button class="copy-btn" onclick="copyJoke()" id="copy-btn">Copy Joke</button>
                </div>
                <div class="confirmation-message" id="confirmation-message">Copied!</div>
            </div>
        </div>
        
        <div class="favorites-section" id="favorites-section">
            <div class="favorites-list" id="favorites-list">
                <div class="empty-favorites" id="empty-favorites">
                    No favorite jokes yet! ‚ù§Ô∏è<br>
                    <small>Click the heart icon next to jokes to save them here.</small>
                </div>
            </div>
        </div>
        
        <div class="recently-viewed-section" id="recently-viewed-section">
            <div class="history-list" id="history-list">
                <div class="empty-history" id="empty-history">
                    No jokes viewed yet! üìö<br>
                    <small>Get some jokes and they'll appear here.</small>
                </div>
            </div>
        </div>
        
        <div class="controls" id="controls">
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="Search for jokes (press Enter to search)">
                <button class="btn btn-secondary" onclick="searchJokes()" id="search-btn">Search</button>
            </div>
            
            <button class="btn" onclick="getRandomJoke()" id="random-btn">Next Joke <span class="kbd-hint">(Enter)</span></button>
        </div>
    </div>

    <script>
        const dadJokes = [
            {setup: "Why don't scientists trust atoms?", punchline: "Because they make up everything!"},
            {setup: "I told my wife she was drawing her eyebrows too high.", punchline: "She looked surprised."},
            {setup: "What do you call a fake noodle?", punchline: "An impasta!"},
            {setup: "Why don't eggs tell jokes?", punchline: "They'd crack each other up!"},
            {setup: "I'm reading a book about anti-gravity.", punchline: "It's impossible to put down!"},
            {setup: "Why did the scarecrow win an award?", punchline: "He was outstanding in his field!"},
            {setup: "What do you call a sleeping bull?", punchline: "A bulldozer!"},
            {setup: "Why don't skeletons fight each other?", punchline: "They don't have the guts!"},
            {setup: "What's the best thing about Switzerland?", punchline: "I don't know, but the flag is a big plus!"},
            {setup: "Why did the math book look so sad?", punchline: "Because it had too many problems!"},
            {setup: "What do you call a bear with no teeth?", punchline: "A gummy bear!"},
            {setup: "Why can't your nose be 12 inches long?", punchline: "Because then it would be a foot!"},
            {setup: "What did the ocean say to the beach?", punchline: "Nothing, it just waved!"},
            {setup: "Why don't programmers like nature?", punchline: "It has too many bugs!"},
            {setup: "What do you call a dinosaur that crashes his car?", punchline: "Tyrannosaurus Wrecks!"},
            {setup: "Why did the cookie go to the doctor?", punchline: "Because it felt crumbly!"},
            {setup: "What's orange and sounds like a parrot?", punchline: "A carrot!"},
            {setup: "Why don't scientists trust stairs?", punchline: "Because they're always up to something!"},
            {setup: "What do you call a fish wearing a crown?", punchline: "A king fish!"},
            {setup: "Why did the bicycle fall over?", punchline: "It was two-tired!"}
        ];

        let currentJokeIndex = 0;
        let isLoading = false;
        let currentJoke = '';
        let favorites = [];
        let currentView = 'main';
        let jokeHistory = [];
        let historyIndex = -1;
        const MAX_HISTORY = 10;

        // Function to fetch a random dad joke from the API
        async function getRandomJoke() {
            if (isLoading) return;
            
            setLoadingState(true);
            clearError();
            
            try {
                // Fetch joke from icanhazdadjoke.com API
                const response = await fetch('https://icanhazdadjoke.com/', {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                // Check if the response is successful
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Parse the JSON response
                const data = await response.json();
                
                // Display the joke
                displayJoke(data.joke);
                
            } catch (error) {
                console.error('Error fetching joke:', error);
                showError('Failed to fetch joke. Please check your internet connection and try again.');
            } finally {
                setLoadingState(false);
            }
        }

        // Function to search for jokes with specific terms
        async function searchJokes() {
            const searchTerm = document.getElementById('search-input').value.trim();
            
            if (!searchTerm) {
                showError('Please enter a search term.');
                return;
            }
            
            if (isLoading) return;
            
            setLoadingState(true);
            clearError();
            
            try {
                // Fetch jokes from the search endpoint
                const response = await fetch(`https://icanhazdadjoke.com/search?term=${encodeURIComponent(searchTerm)}`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Check if any jokes were found
                if (data.results && data.results.length > 0) {
                    // Get a random joke from the search results
                    const randomJoke = data.results[Math.floor(Math.random() * data.results.length)];
                    displayJoke(randomJoke.joke);
                } else {
                    showError(`No jokes found for "${searchTerm}". Try a different search term.`);
                }
                
            } catch (error) {
                console.error('Error searching jokes:', error);
                showError('Failed to search for jokes. Please check your internet connection and try again.');
            } finally {
                setLoadingState(false);
            }
        }

        // Function to get a local joke (from the predefined array)
        function getLocalJoke() {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * dadJokes.length);
            } while (newIndex === currentJokeIndex && dadJokes.length > 1);
            
            currentJokeIndex = newIndex;
            const joke = dadJokes[currentJokeIndex];
            displayJoke(joke.setup + ' ' + joke.punchline);
        }

        // Function to display a joke with smooth animation
        function displayJoke(jokeText, addToHistory = true) {
            const jokeElement = document.getElementById('joke-text');
            currentJoke = jokeText;
            
            // Add fade-out effect
            jokeElement.classList.add('fade-out');
            
            setTimeout(() => {
                // Add to history if it's a new joke (not from navigation)
                if (addToHistory) {
                    addToJokeHistory(jokeText);
                }
                
                // Try to split the joke into setup and punchline
                // Look for common question patterns or use a simple split
                const questionMarkers = ['?', '!'];
                let setup = jokeText;
                let punchline = '';
                
                for (let marker of questionMarkers) {
                    const markerIndex = jokeText.indexOf(marker);
                    if (markerIndex !== -1 && markerIndex < jokeText.length - 1) {
                        setup = jokeText.substring(0, markerIndex + 1).trim();
                        punchline = jokeText.substring(markerIndex + 1).trim();
                        break;
                    }
                }
                
                // If no clear split found, display the whole joke as setup
                if (!punchline) {
                    jokeElement.innerHTML = jokeText;
                } else {
                    jokeElement.innerHTML = setup + '<br><span class="punchline">' + punchline + '</span>';
                }
                
                // Remove fade-out and add fade-in effect
                jokeElement.classList.remove('fade-out');
                jokeElement.classList.add('fade-in');
                
                // Remove fade-in class after animation completes
                setTimeout(() => {
                    jokeElement.classList.remove('fade-in');
                }, 400);
                
                // Update favorite button state
                updateFavoriteButton();
                // Update navigation controls
                updateNavigationControls();
            }, 200); // Half of fade-out duration
        }

        // Function to set loading state
        function setLoadingState(loading) {
            isLoading = loading;
            const buttons = ['random-btn', 'search-btn'];
            
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.disabled = loading;
                
                if (btnId === 'random-btn' || btnId === 'search-btn') {
                    if (loading) {
                        btn.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
                    } else {
                        btn.innerHTML = btnId === 'random-btn' ? 'Next Joke' : 'Search';
                    }
                }
            });
        }

        // Function to show error messages
        function showError(message) {
            clearError();
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            errorDiv.id = 'error-message';
            
            const container = document.querySelector('.container');
            const jokeContainer = document.querySelector('.joke-container');
            container.insertBefore(errorDiv, jokeContainer.nextSibling);
        }

        // Function to clear error messages
        function clearError() {
            const existingError = document.getElementById('error-message');
            if (existingError) {
                existingError.remove();
            }
        }

        // Function to copy the current joke to clipboard
        async function copyJoke() {
            try {
                // Get the current joke text (without HTML tags)
                const jokeElement = document.getElementById('joke-text');
                const jokeText = jokeElement.textContent || jokeElement.innerText;
                
                // Copy to clipboard using the modern Clipboard API
                await navigator.clipboard.writeText(jokeText);
                
                // Show confirmation message
                showConfirmation();
                
            } catch (error) {
                console.error('Failed to copy joke:', error);
                
                // Fallback for older browsers or if clipboard access fails
                try {
                    const textArea = document.createElement('textarea');
                    const jokeElement = document.getElementById('joke-text');
                    const jokeText = jokeElement.textContent || jokeElement.innerText;
                    
                    textArea.value = jokeText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    showConfirmation();
                } catch (fallbackError) {
                    console.error('Fallback copy also failed:', fallbackError);
                    showError('Failed to copy joke. Your browser may not support this feature.');
                }
            }
        }

        // Function to show confirmation message
        function showConfirmation() {
            const confirmationElement = document.getElementById('confirmation-message');
            
            // Show the confirmation message
            confirmationElement.classList.add('show');
            
            // Hide it after 2 seconds
            setTimeout(() => {
                confirmationElement.classList.remove('show');
            }, 2000);
        }

        // Favorites management functions
        function loadFavorites() {
            const stored = localStorage.getItem('dadJokeFavorites');
            favorites = stored ? JSON.parse(stored) : [];
            updateFavoritesCount();
        }

        function saveFavorites() {
            localStorage.setItem('dadJokeFavorites', JSON.stringify(favorites));
            updateFavoritesCount();
        }

        function toggleFavorite() {
            if (!currentJoke) return;
            
            const jokeIndex = favorites.findIndex(fav => fav.text === currentJoke);
            
            if (jokeIndex === -1) {
                // Add to favorites
                const favoriteJoke = {
                    text: currentJoke,
                    id: Date.now().toString(),
                    dateAdded: new Date().toLocaleDateString()
                };
                favorites.push(favoriteJoke);
                showConfirmation('Added to favorites! ‚ù§Ô∏è');
            } else {
                // Remove from favorites
                favorites.splice(jokeIndex, 1);
                showConfirmation('Removed from favorites');
            }
            
            saveFavorites();
            updateFavoriteButton();
            
            // Refresh favorites view if currently viewing
            if (currentView === 'favorites') {
                displayFavorites();
            }
        }

        function updateFavoriteButton() {
            const favoriteBtn = document.getElementById('favorite-btn');
            const isFavorited = favorites.some(fav => fav.text === currentJoke);
            
            if (isFavorited) {
                favoriteBtn.classList.add('favorited');
                favoriteBtn.innerHTML = '‚ù§Ô∏è';
                favoriteBtn.title = 'Remove from favorites';
            } else {
                favoriteBtn.classList.remove('favorited');
                favoriteBtn.innerHTML = '‚ô°';
                favoriteBtn.title = 'Add to favorites';
            }
        }

        function updateFavoritesCount() {
            const countElement = document.getElementById('favorites-count');
            countElement.textContent = `(${favorites.length})`;
        }

        function showMainView() {
            currentView = 'main';
            document.getElementById('main-section').classList.add('active');
            document.getElementById('favorites-section').classList.remove('active');
            document.getElementById('recently-viewed-section').classList.remove('active');
            document.getElementById('main-toggle').classList.add('active');
            document.getElementById('favorites-toggle').classList.remove('active');
            document.getElementById('history-toggle').classList.remove('active');
            document.getElementById('controls').style.display = 'block';
        }

        function showFavoritesView() {
            currentView = 'favorites';
            document.getElementById('main-section').classList.remove('active');
            document.getElementById('favorites-section').classList.add('active');
            document.getElementById('recently-viewed-section').classList.remove('active');
            document.getElementById('main-toggle').classList.remove('active');
            document.getElementById('favorites-toggle').classList.add('active');
            document.getElementById('history-toggle').classList.remove('active');
            document.getElementById('controls').style.display = 'none';
            displayFavorites();
        }

        function showHistoryView() {
            currentView = 'history';
            document.getElementById('main-section').classList.remove('active');
            document.getElementById('favorites-section').classList.remove('active');
            document.getElementById('recently-viewed-section').classList.add('active');
            document.getElementById('main-toggle').classList.remove('active');
            document.getElementById('favorites-toggle').classList.remove('active');
            document.getElementById('history-toggle').classList.add('active');
            document.getElementById('controls').style.display = 'none';
            displayHistory();
        }

        function displayFavorites() {
            const favoritesList = document.getElementById('favorites-list');
            const emptyMessage = document.getElementById('empty-favorites');
            
            if (favorites.length === 0) {
                emptyMessage.style.display = 'block';
                favoritesList.innerHTML = '';
                favoritesList.appendChild(emptyMessage);
                return;
            }
            
            emptyMessage.style.display = 'none';
            favoritesList.innerHTML = '';
            
            favorites.forEach((favorite, index) => {
                const favoriteItem = document.createElement('div');
                favoriteItem.className = 'favorite-item';
                favoriteItem.innerHTML = `
                    <div class="favorite-joke-text">${favorite.text}</div>
                    <div class="favorite-actions">
                        <small>Added: ${favorite.dateAdded}</small>
                        <button class="remove-favorite-btn" onclick="removeFavorite('${favorite.id}')">
                            Remove ‚ùå
                        </button>
                    </div>
                `;
                favoritesList.appendChild(favoriteItem);
            });
        }

        function removeFavorite(favoriteId) {
            favorites = favorites.filter(fav => fav.id !== favoriteId);
            saveFavorites();
            displayFavorites();
            updateFavoriteButton();
            showConfirmation('Removed from favorites');
        }

        // History management functions
        function addToJokeHistory(jokeText) {
            // Don't add duplicates if it's the same as the last joke
            if (jokeHistory.length > 0 && jokeHistory[jokeHistory.length - 1].text === jokeText) {
                return;
            }
            
            const historyItem = {
                text: jokeText,
                id: Date.now().toString(),
                timestamp: new Date().toLocaleTimeString()
            };
            
            jokeHistory.push(historyItem);
            
            // Keep only the last MAX_HISTORY items
            if (jokeHistory.length > MAX_HISTORY) {
                jokeHistory = jokeHistory.slice(-MAX_HISTORY);
            }
            
            // Update history index to point to the latest joke
            historyIndex = jokeHistory.length - 1;
            updateHistoryCount();
        }

        function navigateHistory(direction) {
            if (jokeHistory.length === 0) return;
            
            const newIndex = historyIndex + direction;
            
            // Check bounds
            if (newIndex < 0 || newIndex >= jokeHistory.length) return;
            
            historyIndex = newIndex;
            const historyItem = jokeHistory[historyIndex];
            
            // Display the joke without adding to history
            displayJoke(historyItem.text, false);
        }

        function updateNavigationControls() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const historyInfo = document.getElementById('history-info');
            
            // Update button states
            prevBtn.disabled = historyIndex <= 0;
            nextBtn.disabled = historyIndex >= jokeHistory.length - 1;
            
            // Update info display
            if (jokeHistory.length > 0) {
                historyInfo.textContent = `${historyIndex + 1} of ${jokeHistory.length}`;
            } else {
                historyInfo.textContent = '0 of 0';
            }
        }

        function updateHistoryCount() {
            const countElement = document.getElementById('history-count');
            countElement.textContent = `(${jokeHistory.length})`;
        }

        function displayHistory() {
            const historyList = document.getElementById('history-list');
            const emptyMessage = document.getElementById('empty-history');
            
            if (jokeHistory.length === 0) {
                emptyMessage.style.display = 'block';
                historyList.innerHTML = '';
                historyList.appendChild(emptyMessage);
                return;
            }
            
            emptyMessage.style.display = 'none';
            historyList.innerHTML = '';
            
            // Display history in reverse order (newest first)
            jokeHistory.slice().reverse().forEach((historyItem, index) => {
                const actualIndex = jokeHistory.length - 1 - index;
                const historyItemEl = document.createElement('div');
                historyItemEl.className = 'history-item';
                
                // Mark current joke
                if (actualIndex === historyIndex) {
                    historyItemEl.classList.add('current');
                }
                
                historyItemEl.innerHTML = `
                    <div class="history-item-text">${historyItem.text}</div>
                    <div class="history-item-meta">Viewed at: ${historyItem.timestamp}</div>
                `;
                
                // Add click handler to navigate to this joke
                historyItemEl.addEventListener('click', () => {
                    historyIndex = actualIndex;
                    displayJoke(historyItem.text, false);
                    showMainView();
                });
                
                historyList.appendChild(historyItemEl);
            });
        }

        // Add event listeners for keyboard support
        document.addEventListener('DOMContentLoaded', function() {
            // Load favorites on page load
            loadFavorites();
            
            // Initialize history with the default joke
            const defaultJoke = "Why don't scientists trust atoms? Because they make up everything!";
            addToJokeHistory(defaultJoke);
            updateNavigationControls();
            
            const searchInput = document.getElementById('search-input');
            
            // Enter key in search input triggers search
            searchInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    searchJokes();
                }
            });
            
            // Global Enter key listener for getting next joke (when not in search input)
            document.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    // Only trigger next joke if not focused on search input and in main view
                    if (document.activeElement !== searchInput && currentView === 'main') {
                        getRandomJoke();
                    }
                }
            });
        });
    </script>
</body>
</html>